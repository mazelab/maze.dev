#!/bin/bash
#
# maze vpopqmail domain script - mazevpopqmail/templates/maze-domain.erb
#
#
# this file was generated by puppet
# do not overwrite this file, or puppet will overwrite it again...
# so only customize this file in puppet itself
#
###############################################################################

MESSAGE_USAGE='maze vpopqmail domain [|$domain|add|delete] [$domain]'

addDomain() {
    DOMAIN="$1"

    RESULT=`$VPOPMAIL_BIN/vadddomain $DOMAIN -r`
    STATUS=`echo "$?"`

    echo "$RESULT"
    exit $STATUS
}

deleteDomain() {
    DOMAIN="$1"
    
    RESULT=`$VPOPMAIL_BIN/vdeldomain $DOMAIN`
    STATUS=`echo "$?"`

    echo "$RESULT"
    exit $STATUS
}

listAllDomains() {
    DOMAINS=`$VPOPMAIL_BIN/vdominfo -n | sed ':a;N;$!ba;s/\n\n/\n/g'`

    echo "$DOMAINS"
    exit 0
}

getDomain() {
    DOMAIN="$1"

    INFO=`$VPOPMAIL_BIN/vdominfo $DOMAIN`
    STATUS=`echo "$?"`

    echo "$INFO"
    exit $STATUS
}

case $1 in
  "add")
        if [ -n "$2"  ]; then
            addDomain $2
        fi
    ;;
  "delete")
        if [ -n "$2"  ]; then
            deleteDomain $2
        fi
    ;;
  *)
        if [ -z "$1" ]; then
            listAllDomains
        elif [ -n "$1" -a -z "$2"  ]; then
            getDomain $1
        fi
    ;;
esac

echo $MESSAGE_USAGE
exit 201